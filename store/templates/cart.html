{% extends "base.html" %}
{% block content %}
<div class="container">
  <div class="card">
    <h3>Your cart</h3>

    <table class="table">
      <thead>
        <tr><th>Item</th><th style="width:90px">Qty</th><th style="width:140px">Unit</th><th style="width:160px">Line total</th><th style="width:120px"></th></tr>
      </thead>
      <tbody>
      {% for i in items %}
        {% with a=i.variant.attrs %}
        <tr>
          <td>
            <div style="font-weight:700">{{ i.variant.product.title }}</div>
            <div style="color:#98A2B3;font-size:12px">
              {% if a.size or a.color %}
                {% if a.size %}Size: {{ a.size }}{% endif %}
                {% if a.size and a.color %} · {% endif %}
                {% if a.color %}Color: {{ a.color }}{% endif %}
              {% else %}One size{% endif %}
            </div>
          </td>
          <td>{{ i.quantity }}</td>
          <td>€{{ i.unit|floatformat:2 }}</td>
          <td>€{{ i.line|floatformat:2 }}</td>
          <td><a class="btn" href="{% url 'remove_from_cart' i.id %}">Remove</a></td>
        </tr>
        {% endwith %}
      {% empty %}
        <tr><td colspan="5" style="color:#98A2B3">Your cart is empty.</td></tr>
      {% endfor %}
      </tbody>
    </table>

    <div style="display:flex; justify-content:flex-end; gap:18px; margin-top:10px">
      <div>Net: €{{ net|floatformat:2 }}</div>
      <div>VAT ({{ vat_rate|floatformat:0 }}%): €{{ vat|floatformat:2 }}</div>
      {% if discount and discount > 0 %}
        <div>Discount: −€{{ discount|floatformat:2 }}</div>
      {% endif %}
      <div><b>Total: €{{ gross|floatformat:2 }}</b></div>
    </div>

          <!-- Promo code -->
      <form method="post" action="{% url 'apply_coupon' %}" style="margin-top:16px; display:flex; gap:10px">
        {% csrf_token %}
        <input class="input" name="code" placeholder="Promo code" style="max-width:220px">
        <button class="btn">Apply</button>

        {% if applied_coupon %}
          <span style="color:#98A2B3">
            Applied: <strong>{{ applied_coupon.code }}</strong>
          </span>
          <a class="btn" href="{% url 'remove_coupon' %}">Remove</a>
        {% endif %}
      </form>



    <div style="margin-top:16px">
      <a class="btn" href="{% url 'checkout' %}">Proceed to checkout</a>
    </div>
  </div>
</div>
{% endblock %}
